<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Example-SMC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
  </head>

  <body>
    <h1>SMC</h1>
    <h2>Socket.io</h2>
    <p id="data"></p>
    <h2>Websocket</h2>
    <p id="data-ws"></p>
    <script>
      var socket = io.connect(window.location.origin);
      const dataEl = document.getElementById('data');
      socket.on('connect', function () {
        dataEl.innerHTML = 'Connected to socket.io server';
      });
      socket.on('smc-data', function (data) {
        console.log(data);
        dataEl.innerHTML = JSON.stringify(data);
      });
      socket.on('smc-error', function (data) {
        console.log(data);
        dataEl.innerHTML = JSON.stringify(data);
      });
      socket.on('smc-removed', function (data) {
        console.log(data);
        dataEl.innerHTML = JSON.stringify(data);
      });
      socket.on('smc-inserted', function (data) {
        console.log(data);
        dataEl.innerHTML = JSON.stringify(data);
      });

      // Connection to Websocker Server...
      if (window['WebSocket']) {
        conn = new WebSocket('ws://' + document.location.host + '/ws');
        console.log(document.location.host);
        conn.onopen = function (evt) {
          var item = document.getElementById('data-ws');
          item.innerHTML = '<b>Connection opened.</b>';
        };
        conn.onclose = function (evt) {
          var item = document.getElementById('data-ws');
          item.innerHTML = '<b>Connection closed.</b>';
        };
        conn.onmessage = function (evt) {
          var messages = evt.data.split('\n');
          console.log(messages);
          for (var i = 0; i < messages.length; i++) {
            var item = document.getElementById('data-ws');
            item.innerText = messages[i];
          }
        };
        conn.onerror = function (err) {
          console.log('Socket Error: ', err);
        };
      } else {
        var item = document.getElementById('data-ws');
        item.innerHTML = '<b>Your browser does not support WebSockets.</b>';
        appendLog(item);
      }
    </script>
  </body>
</html>
